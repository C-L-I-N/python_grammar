# 📘 Day 17 - 异常处理与高级技巧

## 一、异常处理 (Exception Handling)

### 为什么需要异常处理？

程序在运行时难免会遇到错误，如用户输入错误、文件不存在、网络中断等。**优雅地处理这些错误**可以防止程序崩溃，提升用户体验。

Python使用 `try` 和 `except` 来处理错误。

### 1. 基本语法

```python
try:
    # 可能出错的代码
    code_that_might_fail
except:
    # 出错时执行的代码
    handle_the_error
```

### 2. 简单示例

```python
try:
    print(10 + '5')  # 数字不能和字符串相加
except:
    print('Something went wrong')

# 输出: Something went wrong
```

### 3. 捕获特定类型的错误

```python
try:
    name = input('Enter your name: ')
    year_born = input('Year you were born: ')
    age = 2024 - year_born  # 这里会出错！year_born是字符串
    print(f'You are {name}. And your age is {age}.')
except TypeError:
    print('类型错误：请检查数据类型')
except ValueError:
    print('值错误：请输入有效的数值')
except ZeroDivisionError:
    print('除零错误：不能除以零')
```

### 4. 完整结构：try-except-else-finally

```python
try:
    name = input('Enter your name: ')
    year_born = input('Year you born: ')
    age = 2024 - int(year_born)  # 转换为整数
    print(f'You are {name}. And your age is {age}.')
except TypeError:
    print('Type error occurred')
except ValueError:
    print('Value error occurred')
except ZeroDivisionError:
    print('Zero division error occurred')
else:
    print('✅ 代码执行成功，没有错误！')  # 无错误时执行
finally:
    print('🔚 无论如何，我都会执行！')  # 总是执行
```

**输出示例：**
```
Enter your name: 张三
Year you born: 1990
You are 张三. And your age is 34.
✅ 代码执行成功，没有错误！
🔚 无论如何，我都会执行！
```

### 5. 简化写法：捕获所有异常

```python
try:
    name = input('Enter your name: ')
    year_born = input('Year you born: ')
    age = 2024 - int(year_born)
    print(f'You are {name}. And your age is {age}.')
except Exception as e:
    print(f'发生错误: {e}')  # 打印具体错误信息
```

---

## 二、打包与解包 (Packing & Unpacking)

Python中有两个重要的运算符：
- `*` 用于**元组/列表**
- `**` 用于**字典**

### 1. 解包列表 (Unpacking Lists)

```python
def sum_of_five_nums(a, b, c, d, e):
    return a + b + c + d + e

lst = [1, 2, 3, 4, 5]

# ❌ 错误写法
# print(sum_of_five_nums(lst))  # TypeError!

# ✅ 正确写法：使用 * 解包
print(sum_of_five_nums(*lst))  # 15
```

**在range中使用解包：**

```python
args = [2, 7]
numbers = range(*args)  # 等同于 range(2, 7)
print(list(numbers))    # [2, 3, 4, 5, 6]
```

**高级解包技巧：**

```python
countries = ['Finland', 'Sweden', 'Norway', 'Denmark', 'Iceland']
fin, sw, nor, *rest = countries
print(fin, sw, nor)  # Finland Sweden Norway
print(rest)          # ['Denmark', 'Iceland']

numbers = [1, 2, 3, 4, 5, 6, 7]
first, *middle, last = numbers
print(first)   # 1
print(middle)  # [2, 3, 4, 5, 6]
print(last)    # 7
```

### 2. 解包字典 (Unpacking Dictionaries)

```python
def unpacking_person_info(name, country, city, age):
    return f'{name} lives in {country}, {city}. He is {age} years old.'

dct = {
    'name': 'Asabeneh', 
    'country': 'Finland', 
    'city': 'Helsinki', 
    'age': 250
}

# 使用 ** 解包字典
print(unpacking_person_info(**dct))
# Asabeneh lives in Finland, Helsinki. He is 250 years old.
```

### 3. 打包列表 (*args)

```python
def sum_all(*args):
    total = 0
    for i in args:
        total += i
    return total

print(sum_all(1, 2, 3))              # 6
print(sum_all(1, 2, 3, 4, 5, 6, 7))  # 28
```

### 4. 打包字典 (**kwargs)

```python
def packing_person_info(**kwargs):
    for key, value in kwargs.items():
        print(f'{key} = {value}')
    return kwargs

packing_person_info(name="Asabeneh", country="Finland", city="Helsinki", age=250)
# 输出:
# name = Asabeneh
# country = Finland
# city = Helsinki
# age = 250
```

---

## 三、展开运算 (Spreading)

类似JavaScript的展开语法：

```python
lst_one = [1, 2, 3]
lst_two = [4, 5, 6, 7]
lst = [0, *lst_one, *lst_two]
print(lst)  # [0, 1, 2, 3, 4, 5, 6, 7]

country_lst_one = ['Finland', 'Sweden', 'Norway']
country_lst_two = ['Denmark', 'Iceland']
nordic_countries = [*country_lst_one, *country_lst_two]
print(nordic_countries)  # ['Finland', 'Sweden', 'Norway', 'Denmark', 'Iceland']
```

---

## 四、enumerate() - 获取索引

当你需要同时获取**索引**和**元素**时：

```python
for index, item in enumerate([20, 30, 40]):
    print(index, item)

# 输出:
# 0 20
# 1 30
# 2 40

# 实际应用
countries = ['China', 'Finland', 'Japan']
for index, country in enumerate(countries):
    if country == 'Finland':
        print(f'Finland found at index {index}')
# Finland found at index 1
```

---

## 五、zip() - 并行遍历

将多个列表**配对**遍历：

```python
fruits = ['banana', 'orange', 'mango', 'lemon']
vegetables = ['Tomato', 'Potato', 'Cabbage', 'Onion']

# 使用zip配对
for f, v in zip(fruits, vegetables):
    print(f'Fruit: {f}, Vegetable: {v}')

# 输出:
# Fruit: banana, Vegetable: Tomato
# Fruit: orange, Vegetable: Potato
# Fruit: mango, Vegetable: Cabbage
# Fruit: lemon, Vegetable: Onion

# 创建字典列表
fruits_and_veges = [{'fruit': f, 'veg': v} for f, v in zip(fruits, vegetables)]
print(fruits_and_veges)
# [{'fruit': 'banana', 'veg': 'Tomato'}, {'fruit': 'orange', 'veg': 'Potato'}, ...]
```

---

## 💻 练习题

```python
# 练习1: 解包练习
names = ['Finland', 'Sweden', 'Norway', 'Denmark', 'Iceland', 'Estonia', 'Russia']
# 将前5个国家存到 nordic_countries，Estonia存到es，Russia存到ru

# 答案：
*nordic_countries, es, ru = names
# 或者更精确：
fin, sw, nor, dk, ice, es, ru = names
nordic_countries = [fin, sw, nor, dk, ice]
```

---

## 📌 本节重点总结

| 概念 | 符号 | 用途 |
|------|------|------|
| try-except | - | 捕获并处理异常 |
| else | - | try成功时执行 |
| finally | - | 无论如何都执行 |
| 解包列表 | `*` | `func(*list)` |
| 解包字典 | `**` | `func(**dict)` |
| 打包参数 | `*args` | 接收任意数量参数 |
| 打包关键字 | `**kwargs` | 接收任意关键字参数 |
| enumerate | - | 获取索引和值 |
| zip | - | 并行遍历多个列表 |

---

> 📌 **教授寄语**：异常处理是写出健壮程序的关键！永远不要让程序因为一个小错误就崩溃。

